<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NyXorA — IP Lookup</title>
  <style>
    /* Reset */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: #0b0c0d;
      color:#e6eef3;
      display:flex;align-items:center;justify-content:center;padding:28px;
    }

    .card{
      width:860px;max-width:98%;background:linear-gradient(180deg,#0f1112,#0a0b0c);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(0,0,0,0.7);
    }

    header{display:flex;align-items:center;gap:14px;margin-bottom:12px}
    .logo{width:46px;height:46px;border-radius:8px;background:#0d0d0d;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.04)}
    .logo strong{font-size:16px;color:#dfe7ee}

    h1{font-size:18px;color:#dfe7ee}
    p.sub{color:#98a1a8;font-size:13px;margin-top:4px}

    .controls{display:flex;gap:10px;margin-top:8px}
    input[type=text]{flex:1;padding:12px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#0b0b0b;color:#e6eef3;font-size:15px}
    input::placeholder{color:#6f7b82}
    button{padding:11px 14px;border-radius:8px;border:0;background:#171819;color:#e6eef3;font-weight:600;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px}

    .muted{font-size:13px;color:#8f9aa0;margin-top:8px}

    /* results */
    .results{margin-top:18px;display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .panel{background:#0c0d0e;padding:14px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
    .k{font-size:12px;color:#9aa6ad}
    .v{font-size:15px;color:#e6eef3;margin-top:6px;word-break:break-word}

    .full{grid-column:1/-1}

    .actions{display:flex;gap:8px;align-items:center}

    footer{margin-top:14px;color:#7e8a90;font-size:12px;display:flex;justify-content:space-between;align-items:center}

    @media (max-width:820px){.results{grid-template-columns:1fr}.card{padding:14px}}
  </style>
</head>
<body>
  <div class="card" role="main">
    <header>
      <div class="logo" aria-hidden="true"><strong>NXA</strong></div>
      <div>
        <h1>NyXorA — IP Lookup</h1>
        <p class="sub">Enter an IPv4 or IPv6 address, or leave blank to lookup your public IP. No frills, clear data.</p>
      </div>
    </header>

    <div class="controls" aria-hidden="false">
      <input id="ipInput" type="text" placeholder="e.g. 8.8.8.8 or 2001:4860:4860::8888" aria-label="IP input" />
      <button id="goBtn">Continue</button>
      <button id="downloadBtn" class="secondary" title="Download last report">Download report</button>
      <button id="copyBtn" class="secondary" title="Copy report to clipboard">Copy report</button>
    </div>
    <div class="muted">This runs in your browser and queries public IP lookup APIs. No account required.</div>

    <div id="resultsWrap" class="results" hidden>
      <div class="panel">
        <div class="k">IP Address</div>
        <div id="r_ip" class="v">—</div>

        <div class="k">Version</div>
        <div id="r_version" class="v">—</div>

        <div class="k">Hostname / Reverse DNS</div>
        <div id="r_hostname" class="v">—</div>

        <div class="k">ASN</div>
        <div id="r_asn" class="v">—</div>

        <div class="k">ISP / Organization</div>
        <div id="r_org" class="v">—</div>
      </div>

      <div class="panel">
        <div class="k">Country</div>
        <div id="r_country" class="v">—</div>

        <div class="k">Region / City</div>
        <div id="r_loc" class="v">—</div>

        <div class="k">Postal</div>
        <div id="r_postal" class="v">—</div>

        <div class="k">Timezone</div>
        <div id="r_tz" class="v">—</div>

        <div class="k">Local time</div>
        <div id="r_time" class="v">—</div>

        <div class="k">Day / Night</div>
        <div id="r_daynight" class="v">—</div>
      </div>

      <div class="panel">
        <div class="k">Latitude, Longitude</div>
        <div id="r_latlon" class="v">—</div>

        <div class="k">Accuracy (km)</div>
        <div id="r_accuracy" class="v">—</div>

        <div class="k">Connection Type</div>
        <div id="r_conn_type" class="v">—</div>

        <div class="k">Proxy / VPN / Tor</div>
        <div id="r_proxy" class="v">—</div>
      </div>

      <div class="panel full">
        <div class="k">Raw provider response</div>
        <pre id="r_raw" class="v" style="max-height:240px;overflow:auto;background:transparent;border-radius:6px;padding:6px">—</pre>
      </div>
    </div>

    <div id="msg" style="margin-top:12px;color:#9aa6ad"></div>

    <footer>
      <div>APIs: ipapi.co (primary) · ipwhois.app (fallback)</div>
      <div id="footerNote">Last query: —</div>
    </footer>
  </div>

  <script>
    // Helper: set text
    const setText = (id, txt) => { const el = document.getElementById(id); if(el) el.textContent = txt ?? '—'; };

    // Elements
    const goBtn = document.getElementById('goBtn');
    const ipInput = document.getElementById('ipInput');
    const resultsWrap = document.getElementById('resultsWrap');
    const msg = document.getElementById('msg');
    const downloadBtn = document.getElementById('downloadBtn');
    const copyBtn = document.getElementById('copyBtn');
    const footerNote = document.getElementById('footerNote');

    // last report stored for download/copy
    let lastReport = null;

    async function lookup(ip){
      resultsWrap.hidden = true;
      msg.textContent = 'Querying...';

      const basePrimary = ip ? `https://ipapi.co/${encodeURIComponent(ip)}/json/` : 'https://ipapi.co/json/';
      const baseFallback = ip ? `https://ipwhois.app/json/${encodeURIComponent(ip)}` : 'https://ipwhois.app/json/';

      try{
        const res = await fetch(basePrimary, {cache: 'no-store'});
        if(!res.ok) throw new Error('primary failed');
        const data = await res.json();
        if(data.error) throw new Error(data.reason || 'primary error');
        const report = buildReportFromIpapi(data);
        displayReport(report);
        msg.textContent = '';
        resultsWrap.hidden = false;
        lastReport = report;
        footerNote.textContent = `Last query: ${new Date().toLocaleString()}`;
        return;
      }catch(e){
        // fallback
        try{
          msg.textContent = 'Primary failed — trying fallback...';
          const r2 = await fetch(baseFallback, {cache: 'no-store'});
          if(!r2.ok) throw new Error('fallback failed');
          const d2 = await r2.json();
          const report = buildReportFromIpwhois(d2);
          displayReport(report);
          msg.textContent = '';
          resultsWrap.hidden = false;
          lastReport = report;
          footerNote.textContent = `Last query: ${new Date().toLocaleString()}`;
          return;
        }catch(err){
          msg.innerHTML = `<span style="color:#ff8a8a">Lookup failed: ${err.message}</span>`;
          console.error(err);
        }
      }
    }

    function buildReportFromIpapi(d){
      // Map useful fields into a consistent report
      const report = {
        source: 'ipapi.co',
        queried_at: new Date().toISOString(),
        ip: d.ip || null,
        version: d.version || (d.ip && d.ip.includes(':') ? 'IPv6' : 'IPv4'),
        hostname: d.hostname || null,
        asn: d.asn || d.org || null,
        org: d.org || null,
        isp: d.org || null,
        country: d.country_name || null,
        country_code: d.country || null,
        region: d.region || null,
        city: d.city || null,
        postal: d.postal || d.postal_code || null,
        timezone: d.timezone || null,
        latitude: d.latitude || d.lat || null,
        longitude: d.longitude || d.lon || null,
        accuracy_km: d.accuracy ? Number(d.accuracy) : (d.latitude && d.longitude ? 50 : null),
        connection: d.network || d.connection || null,
        proxy: d.isp ? null : (d.proxy || null),
        raw: d
      };
      // compute local time/day-night if timezone
      try{
        if(report.timezone){
          const local = new Date().toLocaleString('en-US', {timeZone: report.timezone});
          const hour = parseInt(new Date().toLocaleString('en-US', {timeZone: report.timezone, hour: '2-digit', hour12:false}),10);
          report.local_time = local;
          report.daynight = (hour>=6 && hour<19) ? 'Day' : 'Night';
        }
      }catch(e){ report.local_time = null; report.daynight = null }
      return report;
    }

    function buildReportFromIpwhois(d){
      const tz = (d.timezone && (d.timezone.id || d.timezone)) || null;
      const report = {
        source: 'ipwhois.app',
        queried_at: new Date().toISOString(),
        ip: d.ip || null,
        version: d.version || (d.ip && d.ip.includes(':') ? 'IPv6' : 'IPv4'),
        hostname: d.hostname || d.reverse || null,
        asn: d.asn || null,
        org: d.org || (d.connection && d.connection.org) || null,
        isp: (d.connection && d.connection.isp) || d.org || null,
        country: d.country || null,
        country_code: d.country_code || null,
        region: d.region || null,
        city: d.city || null,
        postal: d.postal || null,
        timezone: tz,
        latitude: d.latitude || null,
        longitude: d.longitude || null,
        accuracy_km: null,
        connection: (d.connection && d.connection.type) || null,
        proxy: d.proxy || d.security && d.security.is_proxy || null,
        raw: d
      };

      try{
        if(report.timezone){
          const local = new Date().toLocaleString('en-US', {timeZone: report.timezone});
          const hour = parseInt(new Date().toLocaleString('en-US', {timeZone: report.timezone, hour: '2-digit', hour12:false}),10);
          report.local_time = local;
          report.daynight = (hour>=6 && hour<19) ? 'Day' : 'Night';
        }
      }catch(e){ report.local_time = null; report.daynight = null }
      return report;
    }

    function displayReport(r){
      setText('r_ip', r.ip || '—');
      setText('r_version', r.version || '—');
      setText('r_hostname', r.hostname || '—');
      setText('r_asn', r.asn || '—');
      setText('r_org', r.org || '—');

      setText('r_country', r.country ? (r.country + (r.country_code ? ' ('+r.country_code+')' : '')) : '—');
      setText('r_loc', [r.region, r.city].filter(Boolean).join(', ') || '—');
      setText('r_postal', r.postal || '—');
      setText('r_tz', r.timezone || '—');
      setText('r_time', r.local_time || '—');
      setText('r_daynight', r.daynight || '—');

      setText('r_latlon', (r.latitude && r.longitude) ? `${r.latitude}, ${r.longitude}` : '—');
      setText('r_accuracy', r.accuracy_km ? String(r.accuracy_km) : '—');
      setText('r_conn_type', r.connection || '—');
      setText('r_proxy', r.proxy ? String(r.proxy) : '—');

      document.getElementById('r_raw').textContent = JSON.stringify(r.raw || {}, null, 2);
    }

    // Buttons
    goBtn.addEventListener('click', ()=>{
      const ip = ipInput.value.trim();
      lookup(ip);
    });

    ipInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') goBtn.click(); });

    downloadBtn.addEventListener('click', ()=>{
      if(!lastReport){ alert('No report to download. Run a lookup first.'); return; }
      const dataStr = JSON.stringify(lastReport, null, 2);
      const blob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const safeIp = (lastReport.ip || 'report').replace(/[^a-z0-9\.\-]/gi, '_');
      a.download = `NyXorA_${safeIp}_${new Date().toISOString().replace(/[:]/g,'-')}.json`;
      a.click();
      URL.revokeObjectURL(url);
    });

    copyBtn.addEventListener('click', async ()=>{
      if(!lastReport){ alert('No report to copy. Run a lookup first.'); return; }
      try{
        await navigator.clipboard.writeText(JSON.stringify(lastReport, null, 2));
        alert('Report copied to clipboard.');
      }catch(e){
        alert('Copy failed — your browser may block clipboard access.');
      }
    });

    // querystring quick-fill
    (function(){
      const params = new URLSearchParams(location.search);
      if(params.has('ip')) ipInput.value = params.get('ip');
    })();
  </script>
</body>
</html>
